<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>WireMock Proxy — Requests</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/_proxy-ui/assets/styles.css" rel="stylesheet" />

    <!-- Dark theme overrides -->
    <style>
        :root {
          --bg: #0f1115;
          --bg-elev: #12151c;
          --bg-elev-2: #0b0e13;
          --fg: #e6e9ef;
          --fg-muted: #a2acba;
          --border: #2a2f3a;
          --accent: #69a1ff;
          --ok: #3fb950;
          --warn: #f5a623;
          --err: #ff6b6b;
        }

        body.dark { background: var(--bg); color: var(--fg); }

        /* Top bar / menu */
        .topbar { background: var(--bg-elev-2) !important; border-bottom: 1px solid var(--border); color: var(--fg); }
        .topbar h1 { color: var(--fg); margin: 0; font-size: 18px; }
        .topbar .btn { color: var(--fg); border-color: var(--border); background: transparent; }
        .topbar .btn:hover { background: rgba(255,255,255,.08); }
        .topbar .btn.btn-secondary { color: var(--fg); background: #1a1f29; border-color: var(--border); }

        /* Make header a flexible row (title | session | actions) */
        .topbar .container {
          display: flex;
          align-items: center;
          gap: 16px;
          padding: 10px 16px;
          flex-wrap: wrap;
        }
        .topbar .spacer { flex: 1 1 auto; }

        /* Session block */
        .session {
          display: inline-flex;
          align-items: center;
          gap: 8px;
          max-width: 100%;
        }
        .session .label { opacity: .85; }
        .session .mono {
          font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
          background: #0c1017;
          color: var(--fg);
          border: 1px dashed var(--border);
          border-radius: 6px;
          padding: 6px 8px;
          width: 360px;
          max-width: 60vw;
        }

        /* Panels / tables */
        .panel { background: var(--bg-elev); border: 1px solid var(--border); color: var(--fg); }
        .panel-header h2 { color: var(--fg); }
        .filters input, .filters select { background: #0c1017; color: var(--fg); border: 1px solid var(--border); }
        .table-wrap { background: transparent; }
        table.table { color: var(--fg); border-color: var(--border); width: 100%; }
        .table th { color: var(--fg-muted); border-bottom: 1px solid var(--border); background: #0c1017; }
        .table td { border-top: 1px solid var(--border); }
        .table tr:hover { background: rgba(255,255,255,.04); }

        /* Generic buttons */
        .btn { color: var(--fg); border: 1px solid var(--border); background: #161a22; }
        .btn:hover { background: rgba(255,255,255,.08); }
        .btn-primary { background: var(--accent); border-color: var(--accent); color: #0a0c10; }
        .btn-primary:hover { filter: brightness(1.05); }
        .btn.btn-secondary { background: #1a1f29; color: var(--fg); }

        /* Inputs / textarea / selects */
        input[type="text"], input[type="number"], textarea, select { background: #0c1017; color: var(--fg); border: 1px solid var(--border); }
        textarea.code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: #0a0d13; }
        label { color: var(--fg); }
        small.hint, .muted { color: var(--fg-muted); }

        /* Modal (Wizard) */
        .modal::backdrop { background: rgba(0,0,0,.6); }
        .modal-card { background: var(--bg-elev); color: var(--fg); border: 1px solid var(--border); }
        .modal-header { background: var(--bg-elev-2); border-bottom: 1px solid var(--border); color: var(--fg); }
        .modal-body { color: var(--fg); }
        .modal-footer { background: var(--bg-elev-2); border-top: 1px solid var(--border); }
        .icon-btn { color: var(--fg); background: transparent; border: 1px solid transparent; }
        .icon-btn:hover { background: rgba(255,255,255,.08); border-color: var(--border); }

        /* Wizard steps */
        .steps .step { color: var(--fg-muted); }
        .steps .step[aria-current="step"], .steps .step.active { color: var(--fg); font-weight: 600; }
        .step-pane h3 { color: var(--fg); }

        /* Segmented control */
        .segmented { display: inline-flex; background: #0c1017; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .segmented input { display:none; }
        .segmented label { padding: 6px 10px; color: var(--fg-muted); cursor: pointer; user-select: none; }
        .segmented input:checked + label { background: #1a1f29; color: var(--fg); }

        /* Key-value editor block */
        .kv-editor { background: #0b0f16; border: 1px solid var(--border); }

        /* Focus visibility */
        :focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }

        /* Toast */
        .toast { background: #0b0e13; color: var(--fg); border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,.4); }
    </style>
</head>
<body class="dark">
<header class="topbar">
    <div class="container">
        <h1>WireMock Proxy — Strawberry</h1>

        <div class="spacer"></div>

        <!-- Session moved INSIDE the container and aligned inline -->
        <div class="session" role="group" aria-label="Mock session">
            <span class="label">Session</span>
            <!-- shows full header line for easy copy -->
            <input id="sessionHeaderLine" class="mono" type="text" readonly value="X-Mock-Session-Id: " />
            <button id="copySessionBtn" class="btn" title="Copy 'X-Mock-Session-Id' header">Copy</button>
            <button id="regenSessionBtn" class="btn" title="Generate new session id">Regenerate</button>
        </div>

        <div class="topbar-actions">
            <button id="refreshBtn" class="btn">Refresh</button>
            <button id="autoToggleBtn" class="btn btn-secondary" aria-pressed="true">Auto: On</button>
        </div>
    </div>
</header>

<main class="container">
    <section class="panel">
        <div class="panel-header">
            <h2>Requests (click a row to create a stub)</h2>
            <div class="filters">
                <input id="filterPath" type="text" placeholder="Filter by path..." />
                <select id="filterMethod" aria-label="Filter by method">
                    <option value="">All methods</option>
                    <option>GET</option><option>POST</option><option>PUT</option>
                    <option>PATCH</option><option>DELETE</option><option>OPTIONS</option>
                </select>
                <button id="clearFiltersBtn" class="btn btn-secondary">Clear</button>
            </div>
        </div>

        <div class="table-wrap">
            <table class="table" aria-label="requests">
                <thead>
                <tr>
                    <th style="width: 90px;">Time</th>
                    <th style="width: 90px;">Method</th>
                    <th>URL</th>
                    <th style="width: 100px;">Status</th>
                    <th style="width: 140px;">Latency, ms</th>
                </tr>
                </thead>
                <tbody id="requestsTbody">
                <!-- rows rendered by app.js -->
                </tbody>
            </table>
        </div>
    </section>
</main>

<!-- Wizard Modal -->
<dialog id="wizardDialog" class="modal">
    <form method="dialog" class="modal-card" id="wizardForm">
        <header class="modal-header">
            <div class="steps">
                <span class="step" data-step="1" aria-current="step">1. Match</span>
                <span class="step" data-step="2">2. Response</span>
                <span class="step" data-step="3">3. Confirm</span>
            </div>
            <button type="button" class="icon-btn" id="closeWizardBtn" aria-label="Close">✕</button>
        </header>

        <section class="modal-body">
            <!-- Step 1 -->
            <div class="step-pane" data-step="1">
                <h3>What to intercept</h3>
                <div class="field">
                    <label>Method</label>
                    <input id="wMethod" type="text" readonly />
                </div>

                <div class="field row">
                    <label>URL match</label>
                    <div class="segmented">
                        <input type="radio" id="matchLoosened" name="matchMode" value="LOOSENED" checked />
                        <label for="matchLoosened">Loosened</label>
                        <input type="radio" id="matchExact" name="matchMode" value="EXACT" />
                        <label for="matchExact">Exact</label>
                    </div>
                </div>

                <div class="field">
                    <label id="urlLabel">Pattern</label>
                    <input id="wUrl" type="text" />
                    <small class="hint">Loosened replaces IDs/UUIDs/numbers with masks to match wider.</small>
                </div>
            </div>

            <!-- Step 2 -->
            <div class="step-pane" data-step="2" hidden>
                <h3>What to return</h3>
                <div class="grid-2">
                    <div class="field">
                        <label>Status</label>
                        <input id="wStatus" type="number" min="100" max="599" />
                    </div>
                    <div class="field">
                        <label>Content-Type</label>
                        <input id="wContentType" type="text" placeholder="application/json" />
                    </div>
                </div>

                <details class="field" id="headersDetails">
                    <summary>Response headers (optional)</summary>
                    <div id="headersEditor" class="kv-editor"></div>
                    <button type="button" class="btn btn-secondary" id="addHeaderBtn">+ Header</button>
                </details>

                <div class="field">
                    <label>Body</label>
                    <textarea id="wBody" class="code" rows="12"></textarea>
                    <small class="hint" id="bodyHint">Detected JSON. The body will be sent as bodyJson.</small>
                </div>

                <div class="grid-2">
                    <div class="field">
                        <label>Uses</label>
                        <input type="number" id="wUses" value="1" min="1" step="1" />
                        <small class="hint">How many times stub will be used.</small>
                    </div>
                    <div class="field">
                        <label>TTL (ms) <span class="muted">(optional)</span></label>
                        <input type="number" id="wTtl" placeholder="e.g. 300000" />
                    </div>
                </div>
            </div>

            <!-- Step 3 -->
            <div class="step-pane" data-step="3" hidden>
                <h3>Review and create</h3>
                <div class="summary">
                    <div><strong>Match:</strong> <span id="sMatch"></span></div>
                    <div><strong>Response:</strong> <span id="sResp"></span></div>
                    <div><strong>Ephemeral:</strong> <span id="sEph"></span></div>
                </div>
                <details class="field">
                    <summary>Preview mapping JSON</summary>
                    <textarea id="previewJson" class="code" rows="14" readonly></textarea>
                </details>
                <div id="createError" class="error" hidden></div>
            </div>
        </section>

        <footer class="modal-footer">
            <button type="button" class="btn btn-secondary" id="backBtn">Back</button>
            <button type="button" class="btn" id="nextBtn">Next</button>
            <button type="button" class="btn btn-primary" id="createBtn">Create</button>
            <button type="button" class="btn" id="closeAfterCreateBtn" hidden>Close</button>
            <a id="viewStubsLink" class="btn btn-secondary" href="/_proxy-ui/stubs" hidden>View stubs</a>
        </footer>
    </form>
</dialog>

<!-- Toaster -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script src="/_proxy-ui/assets/app.js"></script>
</body>
</html>
